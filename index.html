<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PiXiEEDraw</title>
    <link rel="stylesheet" href="assets/css/style.css" />
  </head>
  <body>
    <div class="app-stage">
      <div class="canvas-wrapper">
        <div class="canvas-stage" id="canvasStage">
          <canvas id="pixelCanvas" width="32" height="32"></canvas>
        </div>
        <div id="previewWindow" class="preview-window" aria-label="プレビュー">
          <div id="previewHandle" class="preview-window__handle" role="button" tabindex="0" aria-label="プレビューを移動">PREVIEW</div>
          <canvas id="previewCanvas" width="32" height="32" aria-hidden="true"></canvas>
        </div>
      </div>

      <div
        class="floating-dock"
        id="floatingDock"
        role="toolbar"
        aria-label="ツール操作"
        data-collapsed="true"
        style="top: 24px; left: 24px"
      >
        <div class="floating-dock__grip">
          <button
            class="floating-dock__handle"
            type="button"
            id="dockHandle"
            aria-label="ツールボタンを移動"
          >
            <span class="mini-dock__drag-line" aria-hidden="true"></span>
          </button>
        </div>
        <div class="floating-dock__bar">
          <button
            class="floating-dock__toggle"
            type="button"
            id="dockToggle"
            aria-label="ドックを展開"
            aria-expanded="false"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M7 8.5L12 13.5L17 8.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span class="sr-only">ドックの表示を切り替え</span>
          </button>
        </div>
        <div class="floating-dock__content">
          <div class="floating-dock__group floating-dock__group--mini" id="dockMenu">
            <div class="mini-dock mini-dock--tools" id="toolDock" data-state="compact" data-visible="false">
              <div class="mini-dock__drag" id="toolDockDrag" aria-hidden="true" title="ドラッグで移動">
                <span class="mini-dock__drag-line"></span>
              </div>
              <div class="mini-dock__header">
                <button
                  class="mini-dock__status mini-dock__status-button"
                  type="button"
                  data-dock-state="toolDock"
                  aria-label="ツールボックスを展開"
                  aria-expanded="false"
                >
                  <span class="mini-dock__status-icon">
                    <img id="toolDockStatus" src="assets/icons/tool-pen.png" alt="選択中のツール" width="22" height="22" />
                  </span>
                </button>
              </div>
              <div class="mini-dock__body">
                <div class="mini-dock__grid mini-dock__grid--tools" role="group" aria-label="描画ツール">
                  <button class="mini-button tool-button tool-button--active" type="button" data-tool="pen" data-icon="assets/icons/tool-pen.png" aria-label="ペン">
                    <img src="assets/icons/tool-pen.png" alt="ペン" width="32" height="32" />
                  </button>
                  <button class="mini-button tool-button" type="button" data-tool="eraser" data-icon="assets/icons/tool-eraser.png" aria-label="消しゴム">
                    <img src="assets/icons/tool-eraser.png" alt="消しゴム" width="32" height="32" />
                  </button>
                  <button class="mini-button tool-button" type="button" data-tool="fill" data-icon="assets/icons/tool-fill.png" aria-label="塗りつぶし">
                    <img src="assets/icons/tool-fill.png" alt="塗りつぶし" width="32" height="32" />
                  </button>
                  <button
                    class="mini-button tool-button"
                    type="button"
                    data-toggle="selectionTools"
                    data-default-tool="selectRect"
                    data-default-icon="assets/icons/tool-select-rect.svg"
                    data-default-label="範囲選択ツール"
                    aria-label="範囲選択ツール"
                    aria-haspopup="true"
                    aria-expanded="false"
                  >
                    <img
                      id="selectionToolToggleIcon"
                      src="assets/icons/tool-select-rect.svg"
                      alt="範囲選択ツール"
                      width="32"
                      height="32"
                    />
                  </button>
                  <button
                    class="mini-button tool-button"
                    type="button"
                    data-toggle="shapeTools"
                    data-default-tool="shapeLine"
                    data-default-icon="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAyNCAyNCc+PHJlY3QgeD0nMycgeT0nMTEnIHdpZHRoPScxMCcgaGVpZ2h0PScxMCcgZmlsbD0nbm9uZScgc3Ryb2tlPScjZmZmZmZmJyBzdHJva2Utd2lkdGg9JzInIHJ4PScxJy8+PGNpcmNsZSBjeD0nMTUuNScgY3k9JzguNScgcj0nNC41JyBmaWxsPSdub25lJyBzdHJva2U9JyNmZmZmZmYnIHN0cm9rZS13aWR0aD0nMicvPjwvc3ZnPg=="
                    data-default-label="図形ツール"
                    aria-label="図形ツール"
                    aria-haspopup="true"
                    aria-expanded="false"
                  >
                    <img
                      id="shapeToolToggleIcon"
                      src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAyNCAyNCc+PHJlY3QgeD0nMycgeT0nMTEnIHdpZHRoPScxMCcgaGVpZ2h0PScxMCcgZmlsbD0nbm9uZScgc3Ryb2tlPScjZmZmZmZmJyBzdHJva2Utd2lkdGg9JzInIHJ4PScxJy8+PGNpcmNsZSBjeD0nMTUuNScgY3k9JzguNScgcj0nNC41JyBmaWxsPSdub25lJyBzdHJva2U9JyNmZmZmZmYnIHN0cm9rZS13aWR0aD0nMicvPjwvc3ZnPg=="
                      alt="図形ツール"
                      width="32"
                      height="32"
                    />
                  </button>
                  <button class="mini-button tool-button" type="button" data-tool="pan" data-icon="assets/icons/tool-pan.svg" aria-label="キャンバス移動">
                    <img src="assets/icons/tool-pan.svg" alt="キャンバス移動" width="32" height="32" />
                  </button>
                  <button class="mini-button tool-button" type="button" data-tool="eyedropper" data-icon="assets/icons/tool-eyedropper.png" aria-label="スポイト">
                    <img src="assets/icons/tool-eyedropper.png" alt="スポイト" width="32" height="32" />
                  </button>
                  <button class="mini-button tool-button" type="button" data-toggle="virtualCursor" data-icon="assets/icons/tool-cursor.png" aria-label="仮想カーソル">
                    <img src="assets/icons/tool-cursor.png" alt="仮想カーソル" width="32" height="32" />
                  </button>
                </div>
                <div class="mini-dock__selection-panel" id="shapeToolPanel" hidden aria-hidden="true">
                  <div class="mini-dock__grid mini-dock__grid--tools" role="group" aria-label="図形ツール">
                    <button class="mini-button tool-button" type="button" data-tool="shapeLine" data-icon="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAyNCAyNCc+PHBhdGggZD0nTTQgMjBMMjAgNCcgZmlsbD0nbm9uZScgc3Ryb2tlPScjZmZmZmZmJyBzdHJva2Utd2lkdGg9JzInIHN0cm9rZS1saW5lY2FwPSdyb3VuZCcgc3Rya2UtbGluZWpvaW49J3JvdW5kJy8+PC9zdmc+" aria-label="直線">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAyNCAyNCc+PHBhdGggZD0nTTQgMjBMMjAgNCcgZmlsbD0nbm9uZScgc3Ryb2tlPScjZmZmZmZmJyBzdHJva2Utd2lkdGg9JzInIHN0cm9rZS1saW5lY2FwPSdyb3VuZCcgc3Rya2UtbGluZWpvaW49J3JvdW5kJy8+PC9zdmc+" alt="直線" width="32" height="32" />
                    </button>
                    <button class="mini-button tool-button" type="button" data-tool="shapeCurve" data-icon="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAyNCAyNCc+PHBhdGggZD0nTTQgMTYgUTEyIDQgMjAgMTYnIGZpbGw9J25vbmUnIHN0cm9rZT0nI2ZmZmZmZicgc3Ryb2tlLXdpZHRoPScyJyBzdHJva2UtbGluZWNhcD0ncm91bmQnIHN0cm9rZS1saW5lam9pbj0ncm91bmQnLz48L3N2Zz4=" aria-label="曲線">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAyNCAyNCc+PHBhdGggZD0nTTQgMTYgUTEyIDQgMjAgMTYnIGZpbGw9J25vbmUnIHN0cm9rZT0nI2ZmZmZmZicgc3Ryb2tlLXdpZHRoPScyJyBzdHJva2UtbGluZWNhcD0ncm91bmQnIHN0cm9rZS1saW5lam9pbj0ncm91bmQnLz48L3N2Zz4=" alt="曲線" width="32" height="32" />
                    </button>
                    <button class="mini-button tool-button" type="button" data-tool="shapeCircle" data-icon="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAyNCAyNCc+PGNpcmNsZSBjeD0nMTInIGN5PScxMicgcj0nOCcgZmlsbD0nbm9uZScgc3Ryb2tlPScjZmZmZmZmJyBzdHJva2Utd2lkdGg9JzInLz48L3N2Zz4=" aria-label="円">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAyNCAyNCc+PGNpcmNsZSBjeD0nMTInIGN5PScxMicgcj0nOCcgZmlsbD0nbm9uZScgc3Ryb2tlPScjZmZmZmZmJyBzdHJva2Utd2lkdGg9JzInLz48L3N2Zz4=" alt="円" width="32" height="32" />
                    </button>
                    <button class="mini-button tool-button" type="button" data-tool="shapeCircleFill" data-icon="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAyNCAyNCc+PGNpcmNsZSBjeD0nMTInIGN5PScxMicgcj0nOCcgZmlsbD0nI2ZmZmZmZicvPjwvc3ZnPg==" aria-label="円（塗りつぶし）">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAyNCAyNCc+PGNpcmNsZSBjeD0nMTInIGN5PScxMicgcj0nOCcgZmlsbD0nI2ZmZmZmZicvPjwvc3ZnPg==" alt="円（塗りつぶし）" width="32" height="32" />
                    </button>
                    <button class="mini-button tool-button" type="button" data-tool="shapeRect" data-icon="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAyNCAyNCc+PHJlY3QgeD0nNCcgeT0nNCcgd2lkdGg9JzE2JyBoZWlnaHQ9JzE2JyBmaWxsPSdub25lJyBzdHJva2U9JyNmZmZmZmYnIHN0cm9rZS13aWR0aD0nMicgcng9JzEnLz48L3N2Zz4=" aria-label="四角">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAyNCAyNCc+PHJlY3QgeD0nNCcgeT0nNCcgd2lkdGg9JzE2JyBoZWlnaHQ9JzE2JyBmaWxsPSdub25lJyBzdHJva2U9JyNmZmZmZmYnIHN0cm9rZS13aWR0aD0nMicgcng9JzEnLz48L3N2Zz4=" alt="四角" width="32" height="32" />
                    </button>
                    <button class="mini-button tool-button" type="button" data-tool="shapeRectFill" data-icon="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAyNCAyNCc+PHJlY3QgeD0nNCcgeT0nNCcgd2lkdGg9JzE2JyBoZWlnaHQ9JzE2JyBmaWxsPScjZmZmZmZmJyByeD0nMScvPjwvc3ZnPg==" aria-label="四角（塗りつぶし）">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAyNCAyNCc+PHJlY3QgeD0nNCcgeT0nNCcgd2lkdGg9JzE2JyBoZWlnaHQ9JzE2JyBmaWxsPScjZmZmZmZmJyByeD0nMScvPjwvc3ZnPg==" alt="四角（塗りつぶし）" width="32" height="32" />
                    </button>
                  </div>
                </div>
                <div class="mini-dock__selection-panel" id="selectionToolPanel" hidden aria-hidden="true">
                  <div class="mini-dock__grid mini-dock__grid--tools" role="group" aria-label="範囲選択モード">
                    <button class="mini-button tool-button" type="button" data-tool="selectRect" data-icon="assets/icons/tool-select-rect.svg" aria-label="四角形範囲選択">
                      <img src="assets/icons/tool-select-rect.svg" alt="四角形範囲選択" width="32" height="32" />
                    </button>
                    <button class="mini-button tool-button" type="button" data-tool="selectLasso" data-icon="assets/icons/tool-select-lasso.svg" aria-label="投げ縄選択">
                      <img src="assets/icons/tool-select-lasso.svg" alt="投げ縄選択" width="32" height="32" />
                    </button>
                    <button class="mini-button tool-button" type="button" data-tool="selectMagic" data-icon="assets/icons/tool-select-magic.svg" aria-label="同色選択">
                      <img src="assets/icons/tool-select-magic.svg" alt="同色選択" width="32" height="32" />
                    </button>
                  </div>
                </div>
                <div class="mini-dock__form mini-dock__form--brush">
                  <label class="mini-field mini-field--inline">
                    <span>ブラシ</span>
                    <input id="brushSize" type="range" min="1" max="8" value="1" />
                    <span id="brushSizeDisplay" class="mini-value">1</span>
                  </label>
                </div>
              </div>
            </div>
            <div class="mini-dock mini-dock--palette" id="paletteDock" data-state="compact" data-visible="false">
              <div class="mini-dock__drag" id="paletteDockDrag" aria-hidden="true" title="ドラッグで移動">
                <span class="mini-dock__drag-line"></span>
              </div>
              <div class="mini-dock__header">
                <button
                  class="mini-dock__status mini-dock__status-button"
                  type="button"
                  data-dock-state="paletteDock"
                  aria-label="カラーパレットを展開"
                  aria-expanded="false"
                >
                  <span class="mini-dock__status-color" id="paletteDockStatus" style="background-color: #58c4ff"></span>
                </button>
              </div>
              <div class="mini-dock__body">
                <div class="mini-dock__grid mini-dock__grid--palette swatch-grid" id="palette" role="grid" aria-label="カラーパレット"></div>
              </div>
            </div>
            <div class="mini-dock mini-dock--layers" id="layerDock" data-state="compact" data-visible="false">
              <div class="mini-dock__drag" id="layerDockDrag" aria-hidden="true" title="ドラッグで移動">
                <span class="mini-dock__drag-line"></span>
              </div>
              <div class="mini-dock__header">
                <button
                  class="mini-dock__status mini-dock__status-button"
                  type="button"
                  data-dock-state="layerDock"
                  aria-label="レイヤーパネルを展開"
                  aria-expanded="false"
                >
                  <span class="mini-dock__status-text" id="layerDockStatus">レイヤー1</span>
                </button>
              </div>
              <div class="mini-dock__body">
                <div class="layer-dock" aria-label="レイヤー操作">
                  <div class="layer-dock__controls">
                    <button id="addLayer" class="layer-dock__control" type="button">追加</button>
                    <button id="addFrame" class="layer-dock__control layer-dock__control--alt" type="button" title="フレームを追加 (Shiftで空のフレーム)">フレーム追加</button>
                    <button id="deleteLayer" class="layer-dock__control layer-dock__control--danger" type="button">削除</button>
                  </div>
                  <div class="layer-dock__list" id="layerList" role="listbox" aria-label="レイヤー一覧"></div>
                </div>
              </div>
            </div>
            <div class="mini-dock mini-dock--canvas" id="canvasDock" data-state="compact" data-visible="false">
              <div class="mini-dock__drag" id="canvasDockDrag" aria-hidden="true" title="ドラッグで移動">
                <span class="mini-dock__drag-line"></span>
              </div>
              <div class="mini-dock__header">
                <button
                  class="mini-dock__status mini-dock__status-button"
                  type="button"
                  data-dock-state="canvasDock"
                  aria-label="キャンバス設定を展開"
                  aria-expanded="false"
                >
                  <span class="mini-dock__status-text" id="canvasDockStatus">32×32</span>
                </button>
              </div>
              <div class="mini-dock__body">
                <div class="mini-dock__form" aria-label="キャンバス設定">
                  <input id="pixelSize" type="hidden" value="20" />
                  <label class="mini-field">
                    <span>横幅</span>
                    <input id="canvasWidth" type="number" value="32" min="8" max="128" />
                  </label>
                  <label class="mini-field">
                    <span>縦幅</span>
                    <input id="canvasHeight" type="number" value="32" min="8" max="128" />
                  </label>
                  <button id="resizeCanvas" class="mini-dock__apply" type="button">サイズ反映</button>
                </div>
              </div>
            </div>
          </div>
          <div class="floating-dock__group floating-dock__group--actions">
            <button
              id="togglePreview"
              class="dock-icon-button"
              type="button"
              aria-label="プレビュー表示"
              aria-pressed="true"
            >
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M3 12C5.5 7.5 9 5 12 5s6.5 2.5 9 7c-2.5 4.5-6 7-9 7s-6.5-2.5-9-7Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
                <circle cx="12" cy="12" r="2.5" stroke="currentColor" stroke-width="1.6" />
              </svg>
              <span class="sr-only">プレビュー表示</span>
            </button>
            <button
              id="undoAction"
              class="dock-icon-button"
              type="button"
              aria-label="元に戻す"
              disabled
            >
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M9 5L4 10L9 15" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M4 10H14C16.7614 10 19 12.2386 19 15C19 17.7614 16.7614 20 14 20H9" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
              </svg>
              <span class="sr-only">元に戻す</span>
            </button>
            <button
              id="redoAction"
              class="dock-icon-button"
              type="button"
              aria-label="やり直す"
              disabled
            >
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M15 5L20 10L15 15" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M20 10H10C7.23858 10 5 12.2386 5 15C5 17.7614 7.23858 20 10 20H15" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
              </svg>
              <span class="sr-only">やり直す</span>
            </button>
            <button
              id="exportImage"
              class="dock-icon-button"
              type="button"
              data-panel-target="exportPanel"
              aria-expanded="false"
              aria-label="PNG書き出し"
            >
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 3V15" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M7 10L12 15L17 10" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M5 19H19" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
              </svg>
              <span class="sr-only">PNG書き出し</span>
            </button>
            <button id="clearCanvas" class="dock-icon-button dock-icon-button--danger" type="button" aria-label="全消去">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M6 7H18" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                <path d="M9 7V5.5C9 4.67157 9.67157 4 10.5 4H13.5C14.3284 4 15 4.67157 15 5.5V7" stroke="currentColor" stroke-width="1.6" />
                <path d="M8.5 11L15.5 18" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                <path d="M15.5 11L8.5 18" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
              </svg>
              <span class="sr-only">全消去</span>
            </button>
          </div>
        </div>
      </div>

      <footer class="app-footer">
        <small>© 2025 アルタ</small>
      </footer>
    </div>

    <div class="panel-overlay" id="panelOverlay" hidden></div>

    <div class="floating-panel" id="exportPanel" role="dialog" aria-modal="true" aria-labelledby="exportPanelTitle" hidden>
      <div class="floating-panel__header">
        <h2 id="exportPanelTitle">PNG 書き出し</h2>
        <button class="floating-panel__close" type="button" data-panel-close aria-label="閉じる">×</button>
      </div>
      <div class="floating-panel__body">
        <div class="panel-section panel-section--floating">
          <h3>出力サイズ</h3>
          <label class="field">
            <span>解像度</span>
            <select id="exportSize" class="input-select"></select>
          </label>
          <small class="field-help" id="exportHint">最大解像度は 1024px までです。</small>
        </div>
        <button id="confirmExport" class="button button--block" type="button">PNG を保存</button>
      </div>
    </div>

    <script src="assets/js/app.js" defer></script>
  </body>
</html>
